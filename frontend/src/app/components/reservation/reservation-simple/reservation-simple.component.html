<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Lexend+Giga:wght@500&display=swap"
        rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Leckerli+One&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="top-left-logo">
  <a href="/login">
    <img src="../../../../assets/images/logo.png" alt="Logo">
  </a>
</div>
<div class="container-fluid">
  <div class="col-12 col-lg-10 mx-auto">
    <div class="card custom-card">
      <form #form="ngForm" (ngSubmit)="onSubmit(form)" novalidate>
        <!-- Start row with Title, startTime and Date -->
        <div class="top-banner">
          <div class="row">
            <div class="column">
              <h1 class="font-heading">Reserve</h1>
            </div>
            <div class="column">
              <input
                type="time"
                id="reservationStartTime"
                name="reservationStartTime"
                placeholder="hh:mm"
                class="form-control"
                [(ngModel)]="sharedStartTime"
                #reservationStartTimeModel="ngModel"
                (ngModelChange)="onFieldChange()"
                (change)="onTimeChange($event)"
                required
              />
            </div>
            <div class="column">
              <input
                type="date"
                id="reservationDate"
                name="reservationDate"
                pattern="\d{4}-\d{2}-\d{2}"
                placeholder="dd-mm-yyyy"
                class="form-control"
                [(ngModel)]="sharedDate"
                #reservationDateModel="ngModel"
                (ngModelChange)="onFieldChange()"
                required
              />
            </div>
          </div>

          <hr class="my-4">
        </div>

        <!-- Start row with notification -->
        <div class="row">
          <div class="column">
            <div class="col-lg-12" [class]="reservationStatusClass">
              {{ reservationStatusText }}
            </div>
          </div>
        </div>
        <!-- End row with notification -->

        <!-- Start row with available tables -->
        <div class="row" *ngIf="unavailable && nextAvailableTables.length > 0">
          <div class="column">
            <div class="col-lg-12 justify-content-center">
              <div class="d-flex flex-row justify-content-between w-100">
                <button type="button" class="btn available-btn" *ngFor="let table of nextAvailableTables"
                        (click)="selectAvailable(table)">
                  {{ table.startTime }}, {{ table.date }}
                </button>
              </div>
            </div>
          </div>
        </div>
        <!-- End row with available tables -->

        <hr class="my-4">

        <!-- Start row with advanced view -->
        <div class="row" style="justify-content: center; padding: 2vh">
          <button type="button" class="btn av-btn" routerLink="/reservation-layout">Advanced View -></button>
        </div>
        <!-- End row with advanced view -->

        <!-- Start event-row-content-wrapper with event card and some form-fields -->
        <div [class.event-row-content-wrapper]="upcomingEventsExist">
          <div [class.event-column-left]="upcomingEventsExist">

            <!-- Start row with pax -->
            <div class="row">
              <div class="column pax-container">
                <label for="reservationPax" style="margin-right: 10px;">Table for:</label>
                <input
                  type="number"
                  id="reservationPax"
                  name="reservationPax"
                  placeholder="pax"
                  class="form-control pax-input"
                  [(ngModel)]="reservationCreateDto.pax"
                  #reservationPax="ngModel"
                  (ngModelChange)="onFieldChange()"
                  min="1"
                  required
                />

                <div class="custom-seperator" *ngIf="!authService.isLoggedIn()"></div>

                <div *ngIf="!authService.isLoggedIn()">
                  <input
                    type="text"
                    id="reservationFirstName"
                    name="reservationFirstName"
                    placeholder="First Name"
                    class="form-control"
                    [(ngModel)]="reservationCreateDto.firstName"
                    #reservationFirstName="ngModel"
                    required/>
                  <input
                    type="text"
                    id="reservationLastName"
                    name="reservationLastName"
                    placeholder="Last Name"
                    class="form-control"
                    [(ngModel)]="reservationCreateDto.lastName"
                    #reservationLastName="ngModel"
                    required/>
                  <input
                    type="email"
                    id="reservationEmail"
                    name="reservationEmail"
                    placeholder="Email"
                    class="form-control"
                    [(ngModel)]="reservationCreateDto.email"
                    #reservationEmail="ngModel"
                    required/>
                  <input
                    type="tel"
                    id="reservationMobileNumber"
                    name="reservationMobileNumber"
                    placeholder="Phone (optional)"
                    class="form-control"
                    [(ngModel)]="reservationCreateDto.mobileNumber"
                    #reservationMobileNumber="ngModel"/>
                </div>

                <div class="custom-seperator"></div>

                <div>
                  <textarea
                    id="reservationNotes"
                    name="reservationNotes"
                    placeholder="Notes (optional)"
                    class="form-control notes-textarea"
                    [(ngModel)]="reservationCreateDto.notes"
                    #reservationNotes="ngModel">
                </textarea>
                </div>
              </div>
            </div>
          </div>
          <!-- End event-column-left -->

          <!-- Start event-column-right -->
          <div class="event-column-right" [ngStyle]="{'display': upcomingEventsExist ? 'flex' : 'none'}">
            <div class="custom-event-card">
              <h1 class="font-heading">Events</h1>
              <table class="table table-hover">
                <tbody>
                <tr
                  *ngFor="let event of events | slice:(currentEventPage-1)*itemsPerPage : currentEventPage*itemsPerPage">
                  <td>
                    <div class="event-row">
                      <span class="event-name">{{ event.name }}</span>
                    </div>
                    <div class="event-row">
                      <a class="btn event-info-btn btn-sm"
                         aria-label="Show event details"
                         (click)="showEventDetails(event.hashId)">
                        <i class="bi bi-info-lg"></i>
                      </a>
                      <div class="event-time">{{ event.startTime ? formatDay(event.startTime) : '' }}
                        - {{ event.startTime ? formatDotDate(event.startTime) : '' }}
                      </div>
                    </div>
                  </td>
                </tr>
                </tbody>
              </table>
              <div class="btn-group">
                <a class="btn btn-event-skip btn-sm"
                   aria-label="Previous events"
                   [class.disabled]="currentEventPage === 1"
                   (click)="previousPage()">
                  <i class="bi bi-arrow-left"></i>
                </a>
                <a class="btn btn-event-skip btn-sm"
                   [class.disabled]="currentEventPage === Math.ceil(events?.length / itemsPerPage)"
                   aria-label="Next events"
                   (click)="nextPage()">
                  <i class="bi bi-arrow-right"></i>
                </a>
              </div>
            </div>
          </div>
          <!-- End event-column-right -->
        </div>
        <!-- End event-row-content-wrapper -->

        <!-- Start special offers -->
        <div class="row" *ngIf="specialOffers.length > 0">
          <div class="row">
            <div class="column p-0 align-items-end">
              <a class="btn event-info-btn btn-sm text-black"
                 aria-label="Show Special Offer Information"
                 (click)="showOfferInfo()">
                <i class="bi bi-info-circle"></i>
              </a>
            </div>
            <div class="column p-0">
              <h1 class="font-heading">Special Offers</h1>
            </div>
            <div class="column p-0">
            </div>
          </div>
          <div class="row">
            <div class="custom-order-card m-2 p-2 column" *ngFor="let offer of specialOffers">
              <div class="row">
                {{ offer.name }}
              </div>
              <div class="row">
                <a class="custom-order-button" (click)="selectOffer(offer)">
                  {{ offer.pricePerPax }}€
                </a>
              </div>
            </div>
          </div>
          <div class="row" *ngIf="selectedOffers.length > 0">
            <table>
              <tr *ngFor="let offer of selectedOffers">
                <td>
                  {{ offer.name }}
                </td>
                <td>
                  {{ offer.pricePerPax }}€
                </td>
                <td>
                  <button type="button" class="btn btn-sm btn-light" (click)="removeOffer(offer)">
                    <i class="bi bi-x-lg"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td>
                  Total:
                </td>
                <td>
                  {{ totalPrice }}€
                </td>
              </tr>
            </table>
          </div>
        </div>
        <!-- End special offers -->

        <div class="row">
          <div class="column">
            <div>
              <button type="submit" class="btn btn-danger btn-sm"
                      [disabled]="!form.valid || isBookButtonTimeout || unavailable">
                Book
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal for event details -->
<div class="modal fade" id="event-detail" tabindex="-1" aria-labelledby="event-detail-modal" aria-hidden="true">
  <div class="modal-dialog custom-event-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="event-detail-title">{{ event.name }}</h3>
      </div>
      <div class="modal-body">
        <dl class="row">
          <div class="dt-dd-align">
            <dt class="col-sm-2">From:</dt>
            <dd class="col-sm-10">{{ event.startTime ? formatDay(event.startTime) : '' }}
              - {{ event.startTime ? formatDotDate(event.startTime) : '' }}
              - {{ event.startTime ? formatIsoTime(event.startTime) : '' }}h
            </dd>
          </div>

          <div class="dt-dd-align">
            <dt class="col-sm-2">Until:</dt>
            <dd class="col-sm-10">{{ event.endTime ? formatDay(event.endTime) : '' }}
              - {{ event.endTime ? formatDotDate(event.endTime) : '' }}
              - {{ event.endTime ? formatIsoTime(event.endTime) : '' }}h
            </dd>
          </div>

          <div class="dt-dd-align">
            <dt class="col-sm-2">Info:</dt>
            <dd class="col-sm-10">{{ event.description }}</dd>
          </div>
        </dl>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Info Modal -->
<div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="infoModalLabel">Special Offer Information</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Add special offers to your table reservation at a reduced price.</p>
        <p>Your selected items will be ready for you when you arrive.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Got it!</button>
      </div>
    </div>
  </div>
</div>

</body>


</html>
